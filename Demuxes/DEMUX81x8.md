
Z0 = A & ~S1 & ~S0
Z1 = A & ~S1 & S0
Z2 = A & S1 & ~S0
Z3 = A & S1 & S0

DEF DEMUX21x8_S
	PORT IN A<7:0>
	PORT IN S
	PORT IN !S
	PORT OUT Z0<7: 0>
	PORT OUT Z1<7:0>

	INST A11 AND A<0> !S Z0<0>
	INST A12 AND A<1> !S Z0<1>
	INST A13 AND A<2> !S Z0<2>
	INST A14 AND A<3> !S Z0<3>

	INST A15 AND A<4> !S Z0<4>
	INST A16 AND A<5> !S Z0<5>
	INST A17 AND A<6> !S Z0<6>
	INST A18 AND A<7> !S Z0<7>


	INST A21 AND A<0> S Z1<0>
	INST A22 AND A<1> S Z1<1>
	INST A23 AND A<2> S Z1<2>
	INST A24 AND A<3> S Z1<3>

	INST A25 AND A<4> S Z1<4>
	INST A26 AND A<5> S Z1<5>
	INST A27 AND A<6> S Z1<6>
	INST A28 AND A<7> S Z1<7>
ENDDEF

DEF DEMUX41x8_S
	PORT IN A<7:0>
	PORT IN S<1:0>
	PORT IN !S<1:0>
	
	PORT OUT Z0<7: 0>
	PORT OUT Z1<7:0>
	PORT OUT Z2<7:0>
	PORT OUT Z3<7:0>

	PORT OUT Z4<7:0>
	PORT OUT Z5<7:0>
	PORT OUT Z6<7:0>
	PORT OUT Z7<7:0>

	INST DM1 DEMUX21x8_S A<7:0> S<1> !S<1> Z0 Z1
	INST DM1 DEMUX21x8_S A<7:0> S<1> !S<1> Z0 Z1
	INST DM1 DEMUX21x8_S A<7:0> S<1> !S<1> Z0 Z1
	INST DM1 DEMUX21x8_S A<7:0> S<1> !S<1> Z0 Z1


ENDDEF

# Better
Z0 = ~~(A & ∼(A & S))
Z1 = ~~(S & A)

DEF DEMUX81x8
  PORT IN A
  PORT IN S
  PORT OUT Z0
  PORT OUT Z1
  

  # FIRE: ∼(A & S)
  # WATER: ~(A & FIRE)
  NET FIRE
  NET WATER

  # ∼(A & S)
  INST N1 NAND A S FIRE

  # ~(A & ∼(A & S))
  INST N2 NAND A FIRE WATER

  # A & FIRE (fire)
  INST N3 NOT WATER Z0

  # A & S
  INST N4 NOT FIRE Z1
ENDDEF
